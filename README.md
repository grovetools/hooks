<p align="center">
  <img src="https://grovetools.ai/docs/hooks/images/hooks-logo-with-text-dark.svg" alt="Grove Hooks">
</p>

<!-- DOCGEN:OVERVIEW:START -->

`grove-hooks` captures lifecycle events from local AI agent sessions and job execution tools. It serves as a connector between agent activities, the filesystem, and the `grove` ecosystem.

## Core Mechanisms

**Execution Model**: Tools like Claude and OpenCode can be configured to execute the `hooks` binary at specific lifecycle events, passing JSON payloads via standard input. The process parses the event, updates the local SQLite database at `~/.local/state/grove/hooks/sessions.db`, and exits.

**Session Discovery**: The tool aggregates session data from three sources:
*   **Active Processes**: Scans filesystem PIDs and lock files to determine liveness for interactive agents.
*   **Grove `flow` Jobs**: Scans workspace directories for Markdown files containing YAML frontmatter.
*   **OpenCode**: Reads session history from `~/.local/share/opencode/storage/`.

**State Management**: Session states (`running`, `idle`, `completed`, `failed`) are derived from process liveness checks (PID existence) and metadata updates. For `flow` jobs, status is determined by validating the existence of a corresponding `.lock` file and the active process it references.

## Features

### Terminal Interface (TUI)
The `tui` command renders a hierarchical view of active and historical sessions.
*   **Structure**: Groups sessions by ecosystem, project, and worktree.
*   **Navigation**: Supports filtering by status or type and provides shortcuts to attach to associated `tmux` sessions.
*   **Visual Indicators**: Displays session age, status icons, and job types.

### Repository Hooks
Projects can define custom lifecycle actions via a `.grove-hooks.yaml` file in the project root.
*   **On Stop**: Executes shell commands when a session ends (e.g., linting, cleanup).
*   **Conditions**: Commands can be conditional (e.g., `run_if: changes` checks for git modifications).

### Plan Preservation
The tool automatically synchronizes plans generated by Claude Code's "Plan Mode" with `flow`'s Plan.
*   **Capture**: Listens for `ExitPlanMode` and `Edit` tool events.
*   **Sync**: Extracts plan content and saves it as a `flow` compatible Markdown job file.
*   **Configuration**: Controlled via `grove.yml` or environment variables (e.g., `GROVE_HOOKS_ENABLE_PLAN_PRESERVATION`).

## Integrations

### Claude
The `install` command modifies `.claude/settings.local.json` in the target directory. It registers the binary to run on `PreToolUse`, `PostToolUse`, and `Stop` events.

### OpenCode
The `opencode install` command writes a TypeScript plugin (`grove-integration.ts`) to `~/.config/opencode/plugin/`. This plugin utilizes the OpenCode API to report lifecycle events to the `grove-hooks` database.

### System Notifications
The tool can send desktop notifications for specific events, such as when a background job pauses for user input or a long-running task completes. Configuration is handled via the central `grove` configuration.

<!-- DOCGEN:OVERVIEW:END -->

<!-- DOCGEN:TOC:START -->

See the [documentation](docs/) for detailed usage instructions:
- [Overview](docs/01-overview.md)
- [Examples](docs/02-examples.md)
- [Configuration](docs/03-configuration.md)
- [Command Reference](docs/04-command-reference.md)

<!-- DOCGEN:TOC:END -->
