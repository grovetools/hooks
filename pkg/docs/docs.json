{
  "sections": {
    "command-reference": {
      "title": "Command Reference",
      "content": "This document provides a reference for the `grove-hooks` command-line interface, covering all subcommands and their options.",
      "subsections": [
        {
          "title": "`grove-hooks install`",
          "content": "Initializes the hook configuration within a repository.\n\n### Syntax\n\n\n### Description\n\nThe `install` command configures the current repository to use `grove-hooks` for observability. It creates a `.claude` directory if one does not exist and creates or updates the `.claude/settings.local.json` file. This file is modified to direct Claude Code's hook events (such as tool usage and session completion) to the `grove-hooks` binary.\n\nExisting settings in the file that do not conflict with the hooks configuration are preserved.\n\n### Flags\n\n| Flag | Shorthand | Description | Default |\n| :--- | :--- | :--- | :--- |\n| `--directory` | `-d` | The target repository directory to install hooks in. | `.` |\n\n### Example",
          "code_blocks": [
            "grove-hooks install [flags]",
            "# Install hooks in the current directory\ngrove-hooks install\n\n# Install hooks in a specific project directory\ngrove-hooks install --directory ~/projects/my-app"
          ]
        },
        {
          "title": "`grove-hooks sessions`",
          "content": "Manages and queries locally stored AI agent sessions.\n\n### `grove-hooks sessions list`\n\nLists all tracked sessions in a table format.\n\n#### Syntax\n\n\n#### Description\n\nThis command displays a summary of all sessions recorded by `grove-hooks`, including both interactive Claude sessions and automated `grove-flow` jobs. It automatically cleans up any dead or zombie sessions before displaying the list. The output is sorted to show active sessions first.\n\n#### Flags\n\n| Flag | Shorthand | Description |\n| :--- | :--- | :--- |\n| `--active` | | A shorthand to show only active sessions (hides `completed`, `failed`). |\n| `--json` | | Output the full session data as a structured JSON array. |\n| `--limit` | `-l` | Limit the number of sessions returned. |\n| `--status` | `-s` | Filter the list by a specific status (e.g., `running`, `idle`, `completed`). |\n| `--plan` | `-p` | Filter by plan name. |\n| `--type` | `-t` | Filter by session type (`claude`, `job`). |\n\n#### Example\n\n\n#### Example Output\n\n\n- **CONTEXT**: Shows the repository and branch for Claude sessions, or the plan name for `grove-flow` jobs.\n- **IN STATE**: The time elapsed in the current status (e.g., how long a session has been `running`).\n\n### `grove-hooks sessions get`\n\nRetrieves and displays detailed information for a specific session.\n\n#### Syntax\n\n\n#### Description\n\nUse this command to inspect the full details of a single session, including its type, status, repository context, timing information, and any collected tool usage statistics.\n\n#### Arguments\n\n| Argument | Description |\n| :--- | :--- |\n| `\u003csession-id\u003e` | The unique identifier of the session. |\n\n#### Flags\n\n| Flag | Description |\n| :--- | :--- |\n| `--json` | Output the session details as a JSON object. |\n\n#### Example\n\n\n### `grove-hooks sessions browse`\n\nLaunches an interactive terminal UI to browse, search, and manage sessions.\n\n#### Syntax\n\n\n#### Description\n\nThe `browse` command provides a full-screen, real-time view of all sessions. It allows for dynamic filtering, searching, and inspecting sessions without leaving the terminal. Data is refreshed automatically every second.\n\n#### Keybindings\n\n| Key | Action |\n| :--- | :--- |\n| `↑`/`↓` | Navigate the session list. |\n| `(type to filter)`| Instantly filter sessions by any text content. |\n| `Tab` | Cycle through status filters (`all`, `running`, etc.). |\n| `Enter` | View detailed information for the selected session. |\n| `Space` | Select or deselect one or more sessions. |\n| `Ctrl+A` | Select or deselect all currently visible sessions. |\n| `Ctrl+X` | Archive all selected sessions, removing them from view. |\n| `Ctrl+Y` | Copy the selected session ID to the clipboard. |\n| `Ctrl+O` | Open the session's working directory in your file manager. |\n| `Ctrl+J` | Export the selected session's data to a JSON file. |\n| `Esc`/`Ctrl+C` | Exit the browser. |\n\n### `grove-hooks sessions cleanup`\n\nManually triggers a cleanup of inactive or dead sessions.\n\n#### Syntax\n\n\n#### Description\n\nThis command finds sessions that are marked as `running` or `idle` but whose corresponding process has terminated or has been inactive for an extended period. It marks these sessions as `completed`. This process runs automatically with `list` and `browse`, but can be invoked manually if needed.\n\n#### Flags\n\n| Flag | Description | Default |\n| :--- | :--- | :--- |\n| `--inactive-minutes` | The number of minutes a session must be inactive to be cleaned up. | `30` |",
          "code_blocks": [
            "grove-hooks sessions list [flags]",
            "# List the 10 most recent active sessions\ngrove-hooks sessions list --active --limit 10",
            "SESSION ID    TYPE    STATUS      CONTEXT              USER    STARTED               DURATION    IN STATE\ntest-job-1... job     completed   test-plan            matt    2023-10-27 10:30:05   1s          1s\nclaude-se...  claude  running     grove-hooks/main     matt    2023-10-27 10:29:50   running     15s",
            "grove-hooks sessions get \u003csession-id\u003e [flags]",
            "grove-hooks sessions get claude-session-abcdef123456",
            "grove-hooks sessions browse",
            "grove-hooks sessions cleanup [flags]"
          ]
        },
        {
          "title": "`grove-hooks oneshot`",
          "content": "Provides an integration point for `grove-flow` to track the lifecycle of automated jobs. This command is intended for programmatic use, not direct user interaction.\n\n### `grove-hooks oneshot start`\n\nReceives a JSON payload via standard input to signal the beginning of a `grove-flow` job. It creates a new session record in the database with a type of `oneshot_job`.\n\n### `grove-hooks oneshot stop`\n\nReceives a JSON payload via standard input to signal the end of a `grove-flow` job. It updates the corresponding session's status to `completed` or `failed`."
        },
        {
          "title": "`grove-hooks version`",
          "content": "Prints the version information for the `grove-hooks` binary.\n\n### Syntax\n\n\n### Flags\n\n| Flag | Description |\n| :--- | :--- |\n| `--json` | Output the version information as a JSON object. |",
          "code_blocks": [
            "grove-hooks version [flags]"
          ]
        },
        {
          "title": "Environment Variables",
          "content": "| Variable | Description |\n| :--- | :--- |\n| `GROVE_HOOKS_DB_PATH` | Specifies a custom path to the SQLite database file for testing or alternate configurations. |\n| `GROVE_DEBUG` | If set, enables additional verbose logging for debugging. |"
        }
      ]
    },
    "configuration": {
      "title": "Configuration",
      "content": "`grove-hooks` integrates with other tools by defining commands to be executed at specific points in an AI agent's lifecycle. Configuration is managed through files generated by other tools and via environment variables.",
      "subsections": [
        {
          "title": "Primary Integration: Claude Code",
          "content": "The primary configuration is for integration with the Claude Code CLI. This is automated by the `grove-hooks install` command.\n\n\nThis command creates or updates the `.claude/settings.local.json` file. This file directs Claude Code to execute `grove-hooks` commands when certain events occur. Existing settings in the file are preserved.\n\n### Example `.claude/settings.local.json`\n\nAfter running `install`, the configuration file will contain a `hooks` section:",
          "code_blocks": [
            "# In your project's root directory\ngrove-hooks install",
            "{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \".*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"grove-hooks pretooluse\"\n          }\n        ]\n      }\n    ],\n    \"PostToolUse\": [\n      {\n        \"matcher\": \".*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"grove-hooks posttooluse\"\n          }\n        ]\n      }\n    ],\n    \"Notification\": [\n      {\n        \"matcher\": \".*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"grove-hooks notification\"\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"matcher\": \".*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"grove-hooks stop\"\n          }\n        ]\n      }\n    ],\n    \"SubagentStop\": [\n      {\n        \"matcher\": \".*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"grove-hooks subagentstop\"\n          }\n        ]\n      }\n    ]\n  }\n}"
          ]
        },
        {
          "title": "Hook Triggers",
          "content": "`grove-hooks` responds to lifecycle events triggered by the host application (e.g., Claude Code). Each hook corresponds to a stage of an agent session.\n\n-   **`PreToolUse`**: Executes before an agent uses a tool. This hook records the tool name and its parameters.\n-   **`PostToolUse`**: Executes after a tool has been used. This hook records the tool's output, execution duration, and success or failure status.\n-   **`Notification`**: Triggers when the agent generates a notification. This hook can be used to send system-level desktop notifications.\n-   **`Stop`**: Triggers when a session ends. This hook finalizes the session's status in the database and can execute repository-specific commands.\n-   **`SubagentStop`**: Triggers when a sub-agent completes a delegated task."
        },
        {
          "title": "Environment Variables",
          "content": "-   **`GROVE_HOOKS_DB_PATH`**: Overrides the default path to the SQLite database. The default is `~/.local/share/grove-hooks/state.db`. This is used for isolating data in testing environments.\n-   **`GROVE_DEBUG`**: If set to a non-empty string, enables verbose debug logging to standard output."
        }
      ]
    },
    "examples": {
      "title": "Examples",
      "content": "This document provides practical examples for using `grove-hooks`.",
      "subsections": [
        {
          "title": "Example 1: Basic Session Monitoring",
          "content": "This example covers integrating `grove-hooks` with a project and monitoring an interactive session.\n\n1.  **Install Hooks in Your Project**\n\n    Navigate to the project's root directory and run the `install` command.\n\n    ```bash\n    # In your project's root directory\n    hooks install\n    ```\n\n    This command modifies or creates `.claude/settings.local.json` to configure the Claude CLI to send lifecycle events to `grove-hooks`.\n\n2.  **Start a Claude Session**\n\n    Begin a development session using an integrated tool.\n\n    ```bash\n    claude -p \"Refactor the main database connection logic.\"\n    ```\n\n    When the session starts, `grove-hooks` creates a new record in its local SQLite database.\n\n3.  **List Active Sessions**\n\n    While the session is running, open another terminal and use `hooks sessions list`. The `--active` flag hides completed or failed sessions.\n\n    ```bash\n    hooks sessions list --active\n    ```\n\n    **Expected Output:**\n\n    ```\n    SESSION ID      TYPE      STATUS     CONTEXT              USER    STARTED               DURATION    IN STATE\n    claude-axb...   claude    running    my-project/main      dev     2023-10-27 10:30:05   running     2m15s\n    ```\n\n    The output table shows the session's type, `running` status, repository and branch context, user, start time, and duration in the current state."
        },
        {
          "title": "Example 2: Analyzing a Session",
          "content": "This example shows how to use `grove-hooks` to investigate a specific session's history.\n\n1.  **Find a Specific Session**\n\n    To find a session that has finished its work but has not been terminated, filter the list by status.\n\n    ```bash\n    hooks sessions list --status idle\n    ```\n\n    **Expected Output:**\n\n    ```\n    SESSION ID      TYPE      STATUS     CONTEXT               USER    STARTED               DURATION    IN STATE\n    claude-cyz...   claude    idle     api-refactor/feat...  dev     2023-10-27 11:00:00   15m30s      15m30s\n    ```\n\n2.  **Get Detailed Information**\n\n    Use the `sessions get` command with the session ID to retrieve the full record, including tool usage statistics.\n\n    ```bash\n    hooks sessions get claude-cyz...\n    ```\n\n    **Expected Output:**\n\n    ```\n    Session ID: claude-cyz...\n    Type: claude_session\n    Status: idle\n    Repository: api-refactor\n    Branch: feature/new-auth\n    User: dev\n    Working Directory: /home/dev/projects/api-refactor\n    PID: 12345\n    Started: 2023-10-27T11:00:00Z\n    Ended: 2023-10-27T11:15:30Z\n    Duration: 15m30s\n\n    Tool Statistics:\n      Total Calls: 5\n      Bash Commands: 2\n      File Modifications: 3\n      File Reads: 8\n      Search Operations: 1\n    ```\n\n    The output includes the working directory, PID, user, timing, and a summary of tool usage.\n\n3.  **Browse Sessions Interactively**\n\n    The `sessions browse` command opens a terminal interface for filtering and exploring sessions.\n\n    ```bash\n    hooks sessions browse\n    ```\n\n    The interface provides keybindings for navigation and actions:\n    *   **Type to filter:** Narrows the list by repository, branch, or user.\n    *   **Press `Tab`:** Cycles through status filters (`running`, `idle`, `completed`, `failed`).\n    *   **Press `Enter`:** Views the detailed information for the selected session."
        },
        {
          "title": "Example 3: Integration with Grove Flow",
          "content": "This example shows how `grove-hooks` tracks automated jobs orchestrated by `grove-flow`.\n\n1.  **Create and Run a Grove Flow Plan**\n\n    Use `grove-flow` to define and execute a multi-step plan. `grove-flow` is configured to emit start and stop events to `grove-hooks` for each job.\n\n    ```bash\n    # In a project configured for grove-flow\n    # Initialize a new plan\n    flow plan init new-feature-docs\n\n    # Add a 'oneshot' job to generate documentation\n    flow plan add new-feature-docs --title \"Generate API Docs\" --type oneshot \\\n      -p \"Generate OpenAPI documentation for the new endpoints in user_controller.go\"\n\n    # Run the plan\n    flow plan run\n    ```\n\n2.  **View the Unified Session List**\n\n    While the `flow` plan is running or after it has finished, use `hooks` to view the activity.\n\n    ```bash\n    hooks sessions list\n    ```\n\n    **Expected Output:**\n\n    ```\n    SESSION ID       TYPE      STATUS       CONTEXT                     USER    STARTED               DURATION    IN STATE\n    job-gen-api-...  job       completed    new-feature-docs            dev     2023-10-27 12:05:10   1m5s        1m5s\n    claude-axb...    claude    completed    my-project/main             dev     2023-10-27 10:30:05   25m10s      25m10s\n    ```\n\n    The list includes entries for both interactive (`claude`) and automated (`job`) sessions. For `job` type entries, the `CONTEXT` column displays the `grove-flow` plan name. This provides a single interface to monitor all AI-driven activity in a project."
        }
      ]
    },
    "overview": {
      "title": "Overview",
      "content": "\u003cimg src=\"./images/grove-hooks.svg\" width=\"60%\" /\u003e\n\nGrove Hooks captures information about local AI agent sessions and automated job lifecycles, storing all data in a local SQLite database.\n\n\u003c!-- placeholder for animated gif --\u003e",
      "subsections": [
        {
          "title": "Key Features",
          "content": "*   **Local Data Storage**: All session and event data is stored in a local SQLite database, typically at `~/.local/share/grove-hooks/state.db`.\n*   **Session Monitoring**: Tracks interactive agent sessions (from tools like Claude Code) and automated `oneshot` jobs (from `grove-flow`) in a unified list.\n*   **State Tracking**: Records the lifecycle status of a session, such as `running`, `idle`, `completed`, or `failed`, and includes a mechanism to clean up inactive or terminated sessions.\n*   **Terminal Interface**: The `hooks sessions browse` command provides an interactive terminal UI for filtering, searching, and inspecting session data.\n*   **Configuration Automation**: The `install` command modifies local project settings (e.g., `.claude/settings.local.json`) to integrate with AI agent CLIs.\n*   **System Notifications**: Delivers desktop notifications for events like job failures or tasks that require user input."
        },
        {
          "title": "How It Works",
          "content": "Grove Hooks is a command-line binary that other tools execute at specific lifecycle events. For example, `grove-flow` calls `grove-hooks oneshot start` before executing a job and `grove-hooks oneshot stop` after it finishes.\n\nOn each execution, `grove-hooks` receives a JSON payload via standard input containing event details. It parses this data and writes or updates records in its SQLite database. The `install` command automates this process for tools like the Claude CLI by adding the necessary command calls to its local configuration file."
        },
        {
          "title": "Ecosystem Integration",
          "content": "Grove Hooks serves as an observability component within the Grove tool suite.\n\n*   **Grove Flow (`flow`)**: When `grove-flow` runs `oneshot` jobs, it calls Grove Hooks to signal the start and stop of each job. This allows the progress and status of automated plans to be monitored.\n\n*   **Claude Code**: The `grove-hooks install` command configures the local repository to report events such as tool usage, notifications, and session termination to the Grove Hooks database.\n\n*   **Grove Meta-CLI (`grove`)**: The `grove` command manages the installation and versioning of the `grove-hooks` binary, making it available in the user's `PATH` for other tools to execute."
        },
        {
          "title": "Installation",
          "content": "Install via the Grove meta-CLI:\n\nVerify installation:\n\nRequires the `grove` meta-CLI. See the [Grove Installation Guide](https://github.com/mattsolo1/grove-meta/blob/main/docs/02-installation.md) if you don't have it installed.",
          "code_blocks": [
            "grove install hooks",
            "hooks version"
          ]
        }
      ]
    }
  }
}